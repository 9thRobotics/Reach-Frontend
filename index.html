<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Reach Token (REACH)</title>

    <!-- Web3Modal v2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3modal/2.5.2/web3modal.min.js"></script>

    <!-- WalletConnect v2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/@walletconnect/web3-provider/2.11.0/index.min.js"></script>

    <!-- Ethers.js v5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>

    <style>
        body {
            background: #111;
            color: #fff;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 30px;
        }

        button {
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 18px;
            border: none;
            cursor: pointer;
            background: #46abab;
            color: white;
            margin: 10px;
        }

        button:hover {
            background: #3d9399;
        }

        .box {
            margin-top: 30px;
            padding: 20px;
            background: #1a1a2e;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <h1>Buy Reach Token (REACH)</h1>

    <button id="connectWalletBtn">Connect Wallet</button>
    <button id="buyTokenBtn">Buy REACH Tokens</button>

    <div class="box">
        <h2>Your Wallet:</h2>
        <p id="walletAddress">Not Connected</p>
    </div>

    <script>
        /************************************
        * CONFIG
        ************************************/
        const TOKEN_CONTRACT = "0x41A61CdCf40a074546423Bae987B81733F3FBAc5";   // Your Token
        const SELLER_WALLET = "0x0557afA4318989702376D50B45547F953B7f9B21";   // Seller Wallet

        let provider;
        let signer;
        let userAddress;

        /************************************
        * WEB3MODAL SETUP
        ************************************/
        const wcProvider = new WalletConnectWeb3Provider.default({
            projectId: "c9a8238f1e4b213249f3dfd76bd84f89", // Public project ID
            chains: [1], // Ethereum mainnet
        });

        const web3Modal = new window.Web3Modal.default({
            cacheProvider: false,
            providerOptions: {
                walletconnect: {
                    package: WalletConnectWeb3Provider.default,
                    options: {
                        projectId: "c9a8238f1e4b213249f3dfd76bd84f89",
                        chains: [1],
                    }
                }
            }
        });

        /************************************
        * CONNECT WALLET
        ************************************/
        async function connectWallet() {
            try {
                const instance = await web3Modal.connect();
                provider = new ethers.providers.Web3Provider(instance);
                signer = provider.getSigner();

                userAddress = await signer.getAddress();
                document.getElementById("walletAddress").innerText = userAddress;

                alert("Wallet Connected!");
            } catch (err) {
                console.error(err);
                alert("Failed to connect wallet.");
            }
        }

        document.getElementById("connectWalletBtn").onclick = connectWallet;

        /************************************
        * BUY TOKENS
        ************************************/
        async function buyTokens() {
            if (!signer) {
                alert("Connect your wallet first.");
                return;
            }

            let amount = prompt("How many REACH tokens do you want?");

            if (!amount || isNaN(amount) || amount <= 0) {
                alert("Invalid amount");
                return;
            }

            let ethPrice;
            try {
                // Fetch ETH price
                const resp = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd");
                const price = await resp.json();
                ethPrice = price.ethereum.usd;
            } catch (err) {
                alert("Error fetching ETH price.");
                return;
            }

            // Token price = $27 per REACH
            const tokenPriceUSD = 27;
            const totalUSD = tokenPriceUSD * amount;
            const totalETH = (totalUSD / ethPrice).toFixed(6);

            const confirmTx = confirm(
                `Buy ${amount} REACH?\nTotal: ${totalETH} ETH\n\nProceed?`
            );

            if (!confirmTx) return;

            try {
                const tx = await signer.sendTransaction({
                    to: SELLER_WALLET,
                    value: ethers.utils.parseEther(totalETH)
                });

                alert("Transaction Sent! Waiting for confirmation...");
                await tx.wait();

                alert("Purchase Successful!");
            } catch (err) {
                console.error(err);
                alert("Transaction failed: " + err.message);
            }
        }

        document.getElementById("buyTokenBtn").onclick = buyTokens;
    </script>

</body>
</html>

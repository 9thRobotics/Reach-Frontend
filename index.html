<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reach DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 20px; }
    button { padding: 10px 18px; margin: 5px; border-radius: 6px; cursor: pointer; }
    .container { max-width: 700px; margin: auto; }
    .card { background: #1c1c1c; padding: 20px; border-radius: 10px; margin-top: 15px; }
    input { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Reach Token Delivery</h2>

    <button id="connectBtn">Connect Wallet</button>
    <p id="walletAddress">Not Connected</p>

    <div class="card">
      <h3>Token Contract</h3>
      <p><b>Token Address:</b> 0x41A61CdCf40a074546423Bae987B81733F3FBAc5</p>
      <p><b>Seller Contract:</b> 0x0557afA4318989702376D50B45547F953B7f9B21</p>
    </div>

    <div class="card">
      <h3>Buy Tokens</h3>
      <label>ETH Amount:</label>
      <input id="buyAmount" placeholder="0.01" />
      <button id="buyBtn">Buy Tokens</button>
    </div>

    <div class="card">
      <h3>Auto Delivery</h3>
      <p>Automatically delivers purchased tokens after the transaction confirms.</p>
      <button id="deliverBtn">Run Delivery</button>
    </div>
  </div>

<script>
const TOKEN_ADDRESS = "0x41A61CdCf40a074546423Bae987B81733F3FBAc5";
const SELLER_ADDRESS = "0x0557afA4318989702376D50B45547F953B7f9B21";

const ETH_MAINNET_CHAIN_ID = "0x1"; // Fix for WalletConnect "No chainId found match ethereum"

let provider, signer;

async function connectWallet() {
  if (!window.ethereum) {
    alert("No MetaMask found.");
    return;
  }

  await window.ethereum.request({
    method: "wallet_switchEthereumChain",
    params: [{ chainId: ETH_MAINNET_CHAIN_ID }]
  });

  await window.ethereum.request({ method: "eth_requestAccounts" });

  provider = new ethers.BrowserProvider(window.ethereum);
  signer = await provider.getSigner();

  document.getElementById("walletAddress").innerText = await signer.getAddress();
}

async function buyTokens() {
  if (!signer) return alert("Connect wallet first.");

  const amount = document.getElementById("buyAmount").value;
  if (!amount) return alert("Enter ETH amount.");

  const tx = await signer.sendTransaction({
    to: SELLER_ADDRESS,
    value: ethers.parseEther(amount)
  });

  await tx.wait();
  alert("Purchase complete — delivery will follow.");
}

async function autoDeliver() {
  alert("Auto‑Delivery placeholder — backend logic executes delivery.");
}

// Bind buttons
connectBtn.onclick = connectWallet;
buyBtn.onclick = buyTokens;
deliverBtn.onclick = autoDeliver;
</script>
</body>
</html>
